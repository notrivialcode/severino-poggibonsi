#!/bin/sh

. "$(dirname "$0")/_env.sh"


# ğŸ‰ Welcome message
echo -e "${CYAN}${BOLD}NOTRIVIALÂ®${NC}${CYAN} is kicking off its pre-commit fiesta!${NC}"

# 1) lint-staged
echo -e "${BLUE}âœ¨ Running lint-staged magicâ€¦${NC}"
if npx lint-staged; then
  echo -e "${GREEN}âœ… lint-staged says: all clear!${NC}"
else
  echo -e "${YELLOW}âš ï¸  lint-staged found some messâ€”tidy up before committing!${NC}"
  exit 1
fi

# 2) TypeScript check
echo -e "${BLUE}ğŸ” Checking TypeScript typesâ€¦${NC}"
if npx tsc --noEmit; then
  echo -e "${GREEN}âœ… TypeScript gives us a thumbs up!${NC}"
else
  echo -e "${YELLOW}âš ï¸  TypeScript errors aheadâ€”please fix them first!${NC}"
  exit 1
fi

# 3) Run tests
echo -e "${BLUE}ğŸ§ª Running testsâ€¦${NC}"
if npm test -- --passWithNoTests; then
  echo -e "${GREEN}âœ… All tests passed!${NC}"
else
  echo -e "${YELLOW}âš ï¸  Some tests failedâ€”please fix them before committing!${NC}"
  exit 1
fi

# ğŸŠ Final success banner
echo -e "${CYAN}ğŸš€ All checks passed! You're officially cleared by ${BOLD}NOTRIVIALÂ®${NC}${CYAN}! Commit away!${NC}"
